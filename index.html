<!DOCTYPE html>
<html>
<head>
<title>Exit Trip</title>
<meta charset="utf-8" />
<script src="js/extlibs/ben0biJSLoader.js"></script>
<style>
	body, html
	{
		padding: 20;
		margin: 0;
		width: 100%;
		height: 100%;
		font-family: monospace;
	}
	#dungeon
	{
		background-color: rgb(51, 51, 51);
		color: #9C6;
		z-index: 0;
	}
	.cnt_overlay
	{
		position: absolute;
		top: 0px;
		left: 0px;
		width: 100%;
		height: 100%;
		overflow: hidden;
	}

	#values, #message
	{
		position: absolute;
		top: 0px;
		right: 0px;
		min-width: 300px;
		font-family: monospace;
		background-color: #3A3;
		color: #000000;
	}

	#values
	{
		position: absolute;
		font-size: 20pt;
		font-weight: bold;
		top: 0px;
		right: 0px;
		height: 120px;
		width: 200px;
		padding: 10px;
	}

	#message
	{
		padding: 10px;
		position: absolute;
		top: 150px;
		right: 0px;
		min-height: 15px;
		font-size: 10pt;
		font-weight: bold;
	}


	/* MAP CLASSES */
	.ground {color: #777;}
	.player {color: #FF3;font-weight: bolder;}
	.stairs {color: rgb(219, 205, 0);}
	.item {color: #69A;}
	.monster {color: #F33;}

</style>
</head>
<body>
<div id="dungeon" class="cnt_overlay"></div>
<div id="values"></div>
<div id="message">Halli Hallo</div>
<script>

function print(dg,player)
{
	$("#dungeon").html(dg.print(player));
	$("#values").html(player.printValues(dg));
	if(getMessage()!="")
	{
		$("#message").html(getMessage());
		log(getMessage());
	}
}

function main()
{
	log("MAIN");
	var props = {
		roomcount: 15,
		mapsizex: 100,
		mapsizey: 40,
		minroomx: 3,
		minroomy: 3,
		maxroomx: 10,
		maxroomy: 10
	}
	var dg = new DungeonGenerator();
	dg.setProperties(props)
	dg.generate();

	var player = new Player();
	player.setPosition(dg.getPlayerStartPosition().x, dg.getPlayerStartPosition().y);
	player.move(0,dg); // show some tiles.

	print(dg, player);
	document.onkeydown = function(evt)
	{
		evt = evt || window.event;
		var charCode = evt.keyCode || evt.which;
		//log("CHAR: "+charCode);
		// get arrow keys and other special characters.
		switch(charCode)
		{
			case 37: player.move(1, dg); break;
			case 38: player.move(2, dg); break;
			case 39: player.move(3, dg); break;
			case 40: player.move(4, dg); break;
			default: break;
		}
		var charStr = String.fromCharCode(charCode);
		switch(charStr.toLowerCase())
		{
			case 'a': player.move(1,dg);break;
			case 'w': player.move(2,dg);break;
			case 'd': player.move(3,dg);break;
			case 's': player.move(4,dg);break;
		}
		// create new if died.
		if(player.getHealth()<=0)
		{
			dg.setProperties(props);
			dg.resetFloorNumber();
			dg.generate();
			player=new Player();
			player.setPosition(dg.getPlayerStartPosition().x, dg.getPlayerStartPosition().y);
			player.move(0,dg);
			setMessage("YOU DIED!<br />Welcome to your new life.");
		}
		print(dg,player)
	};
};

ben0biJSLoader.recursiveLoad("js/jsfiles.json", main);
</script>
</body>